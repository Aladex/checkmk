properties([
    pipelineTriggers([triggers: [upstream(upstreamProjects: "cmk_160/windows-agent-build", threshold: hudson.model.Result.SUCCESS)]]),
])

timeout(time: 12, unit: 'HOURS') {
    node('win3') {
        stage('git checkout') {
            checkout(scm)
        }
        stage('download artifacts') {
            dir('artefacts') {
                script {
                    step([$class     : 'CopyArtifact',
                          projectName: 'cmk_160/windows-agent-build',
                    ]);
                }
            }
        }
        stage('windows integration test') {
            bat 'cd agents\\wnx && call call_integration_tests.cmd'
        }
    }
}
